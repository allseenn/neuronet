# Нейронные сети

## Урок 8. GAN

### Домашнее задание

Сдавать как обычно.

- Задание - Обучите нейронную сеть любой архитектуры на каком-то производственном датасете. Сделайте анализ того, что вам помогло в улучшения работы нейронной сети.
- Можно сегментацию по Северстали.

В конце, обязательно подвести вывод.

## Решение

### Сегментация по Северстали

Работа основна на [решение](https://github.com/ml-projects-rana/Steel-Defect-Detection---Image-Segmentation-using-Keras-and-Tensorflow) индийского аналитика Дипаншу Рана

В ходе исследования возникли следующие проблемы:

1. Версионная совместимость кода
2. Вычислительные мощности
3. Распределенные вычисления
4. Проприетарные API

#### 1. Версионная совместимость кода

Код Рана последний раз редактировался более 3-х лет назад, на тот момент использовался Python 3.7 tensorflow 2.8.0 keras 2.8.0. 
Из-за несовместимости пакетов, приходилось по брошенным исключениями эксперементировать с разными конфигурациями и версиями пакетов. Т.к. понижение версии, например keras, вызивала ошибки у других пакетов. 
В процессе исследования приходилось сохранять промежуточные результаты в бинарные файлы, формат которых тоже имеет версионность и не совместим с разными версиями пакетов. Так, пришлось переделать первую часть данной работы, лишь только из-за того, что сохраненные параметры модели не поддерживаются новой версией tensorflow. А это много часовые ожидания и затраты вычислительный мощностей.

#### 2. Вычислительные мощности

Как было сказано ранее, вся работа по сегментации выявленных дефектов, состоит из нескольких этапов:
- Разведочный анализ
- Бинарная классификация
- Многоклассовая классификация
- Сегментация
- Финальный этап

Т.к. данные содержат около 20 тысяч картинок, а работа с изображенями очень требовательное к ресурсам задача, то каждый этап выполнялся в отдельном ноутбуке и исчерпывал ресурсы одной учетной записи гугл-колаба, промежуточные результаты сохранились в бинарные файлы, которые при старте следующиего этапа, предварительно подгружались в память для использования их в новых расчетах.
Так самым требовательным оказался этап именно по сегментации, для каждого класса дефекта обучение модели подразумевает 25 эпох. Но, на самой мощной конфигурации GPU T4 от гугл-колаба, одна эпоха обучения и валидации длится более двух часов. Т.е. обучения только по одному типу дефектов необходимо 50 часов машинного времени колаба. На бесплатном тарифе машинного времени хватало максимум на пару эпох в результате чего виртуальная среда колаба останавливалась с предупреждением об исчерпании ресурсов.
Было принято решение этап сегментации, частично, хотябы для первого типа дефекта, с таким количеством эпох, которое позволит время, что машинное, что рамки сдачи итоговой работы, выполнить на Кагле.
Кагле позволяет одновременно использовать четыре видеокарты, в результате время выполеннение одной эпохи обучения, происходилов в четыре раза быстрее, что примерно составляло около 40 минут. Т.е. при выполенние обучения только по одному дефекту требует времени окло 10 часов. Но на четыре дефекта нужно времени около 40 часов. Что опять превыжает лимиты, огараниченные бесплатным тарифом в 30 часов.

#### 3. Расппределенные вычисления

Разбивка на этапы с сохранением результатов, позволяет производить распределенные вычисления, на разных системах. Используя несколько учетных записей, и на разных вычислительных системах (колаб, кагл или локальный юпитер ноутбук).
И тут основной проблеймой выступет совместимость не только кода, но и возможности по взаимодействюи с системами.
Гугл позволяет взаимодействовать только в основном через гугл диск, колаб имеет больше возможновстей через его API

#### 4. Проприетарные АPI

Гугл колаб не имеет открытых апи, более того его политика всячески запрещает использвоание стороннего ПО для проинкновения в его виртуальные машины. Кагла в этом плане более открытая платформа имеющая набор API, но процесс например загрузки и выгрузки бинарных файлов. Я смог осуществить только с помощью своего сервера.

## Выводы

Работа с нейросетями требует огромных вычислительных ресурсов. 
Можно потратить сотни тысяч рублей на видеокарты, так карата NVIDIA T4 Tesla 16GB, аналагичная GPU T4 колаба стоит около 200 тысяч рублей. Чтобы выйти на мощности колаба с четырмя видюхами и остальным железом, необходимо вложить миллион рублей. И это без учета эллектричества, которые этим мощности будут поедать.

Поэтому перспектывным для себя вижу навыки devops, по работе с облачной инфраструктурой. А также разработка ПО, позволяющего объеденить облачные вычислительные ресурсы в один интерфейс, для разворачивания и обучения промышленных моделей уровня Северстали.
Как Вам такая тема для дипломного проекта?